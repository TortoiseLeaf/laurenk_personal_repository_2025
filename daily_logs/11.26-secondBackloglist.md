
Landing page check db done

Consent page done

AndroidUsageAPIService
- UML
-----
R2 (end of Feb)

Release 2
- Display data in dashboard
- Calculate CO2e
- Nature facts db added
- Compare to natural event
- discuss a reporting method to forestry team



Sprint goal is to finish the data collection service, build frontend components for the Dashboard, build the CO2 service, and plug in data from the data collection and CO2 service into the frontend.


## Complete data collection service per uml **
 
use the UML to develop the collection service. 
- create whitelist of apps
- check if whitelist apps exist on device, add to a list if so
- get data usage for the whitelisted apps installed on device

- convert from milliseconds to minutes (or hours and minutes)
- send data to dashboard page



## Display data in dashboard **
DashboardPage

DashboardView
- Add visual components similar to the wireframe
	- Look at wireframe with team, decide which components to start with 
	- Bargraph?
	- list each app (cards?): AppName, Mins used, CO2e, icon?
	- 
DashboardViewModel
- add data from the usage collection service to the visual components in the view 


// R3

## Events page
- Take EventsDb obj from 

	## GoalPage
	- TreesPlanted
	- TreesPlanted() shows CO2e and goal

-----

## CO2 service **
create a service that plugs into the dashboard where `if (permission) {run CO2 Service()}`
using a method that:
CalculateCO2e()
- takes in usage data usage per app
		- query a local conversion table db, match the package name with the CO2e (`where pkgname == input return CO2e`)
- convert milliseconds into minutes
- Calculate the CO2e value for the app by usage mins
- return result to dashboard


%% - call this function once daily (**how if the apps not running?**) at 23:58 and save total as CO2Total in activityLog with pkg name, total mins and total CO2e, and date
 %%


 CO2Total() %% ( a new service or just a method in the CO2 service? ) %%
 At 23:55 every day,
- get all CO2Total data from the same date
	- iterate through installed whitelist apps with caclulateCO2() and push each CO2e to a list
	- total the list
- save total to ActivityLog db with date as Date and CO2Total

// R3?

CO2SavedDaily()
- get CO2Total from activityLog for todays date, yesterdays too
- subtract to see if there's a reduction in the CO2 total
- save to CO2SavedDaily in activityLog

SavedDaily vs TotalSaved? audit vs accumulative

TreesPlanted()
- check CO2TotalSaved amount 
- out of 500g? 
- if CO2TotalSaved = 500g, TreesPlanted+1
- return CO2TotalSaved and 500g Goal to GoalPage

------

%% ** CO2 daily amount only saves as the total to activityLog
CO2 service feeds to DailyTotalService?
CO2 service feeds to Dashboard, then to DailyTotalService?
Call dailytotalservice into Dashboard? %%

%% DailyTotalService
- total CO2 of all apps from today
- Save to CO2TotalToday
- at 23:55 daily, save total to CO2TotalPrev
- compare, if both data exists today total from prev 
- save CO2difference with date to activityLog
- CO2SavedTotal = sum CO2difference and display date started** %%

----------

## Nature DB **
- add Nature facts to db, to project
- use Gracjans software to generate the nature data
- check manually or code a script to check links are valid and safe
- add the db file to the project
- make the db reader reusable and use the service with that to read the db file


(DESIGN QUESTION: Use the CO2Total for comparisons, use the difference saved for the Trees goal?)
## CO2EventPage 

CO2EventViewModel
- inject CO2eService, NatureDb
- take CO2eService.CO2Total
- takes event obj from natureDb `where CO2Total is like natureEvent.CO2`
%% - SELECT * FROM NATUREDB WHERE co2 is like co2savedtotal
 %%
 - return natureDb event obj, plug it into CO2EventView



Trees
- CO2SavedTotal out of 500g
- if 1000g, TreesPlanted +1

UserControlsPage
- revoke consent
- delete consent data

---------------


Data service needs todays date saved to data model



```
//FirstTimeStamp = DateTimeOffset.FromUnixTimeMilliseconds(usageStats.FirstTimeStamp).DateTime,
//LastTimeStamp = DateTimeOffset.FromUnixTimeMilliseconds(usageStats.LastTimeStamp).DateTime,
//LastTimeUsed = DateTimeOffset.FromUnixTimeMilliseconds(usageStats.LastTimeUsed).DateTime

string jsonString = System.Text.Json.JsonSerializer.Serialize(usageData);
Console.WriteLine($"My data: {jsonString}");
```

